# Viecom Admin Dashboard Setup Guide

## ğŸ“‹ æ¦‚è¿°

Viecom Admin Dashboard æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ç®¡ç†åå°ï¼Œç”¨äºç›‘æ§å’Œç®¡ç†å¹³å°çš„ç”¨æˆ·ã€è®¢é˜…ã€æ”¯ä»˜å’Œç§¯åˆ†æ•°æ®ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```bash
# Admin JWT Secret (ç”¨äºç®¡ç†å‘˜è®¤è¯)
ADMIN_JWT_SECRET=your-super-secret-admin-key-change-this-in-production

# é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼ˆå¯é€‰ï¼Œç”¨äºé¦–æ¬¡åˆ›å»ºï¼‰
ADMIN_EMAIL=admin@viecom.pro
ADMIN_PASSWORD=change-me-immediately
```

### 2. æ•°æ®åº“è¿ç§»

è¿è¡Œ Drizzle è¿ç§»ä»¥åˆ›å»º `admins` è¡¨ï¼š

```bash
pnpm db:generate
pnpm db:migrate
```

### 3. åˆ›å»ºç¬¬ä¸€ä¸ªç®¡ç†å‘˜è´¦å·

è¿è¡Œåˆ›å»ºç®¡ç†å‘˜è„šæœ¬ï¼š

```bash
pnpm tsx src/scripts/create-admin.ts
```

è¿™å°†åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ï¼š
- **Email**: `admin@viecom.pro`ï¼ˆæˆ–ä½ è®¾ç½®çš„ ADMIN_EMAILï¼‰
- **Password**: `admin123456`ï¼ˆæˆ–ä½ è®¾ç½®çš„ ADMIN_PASSWORDï¼‰

**âš ï¸ é‡è¦**ï¼šé¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç ï¼

---

## ğŸ“Š åŠŸèƒ½æ¨¡å—

### 1. Dashboardï¼ˆä»ªè¡¨ç›˜ï¼‰
**è·¯å¾„**: `/admin/dashboard`

**åŠŸèƒ½**ï¼š
- ğŸ“ˆ ä»Šæ—¥æ–°æ³¨å†Œç”¨æˆ·æ•°
- ğŸ‘¥ è¿‡å» 7/30/90 å¤©æ–°å¢ç”¨æˆ·
- ğŸ’³ å½“å‰æ´»è·ƒè®¢é˜…æ•°
- ğŸ’° ä»Šæ—¥æ”¶å…¥ç»Ÿè®¡
- ğŸ–¼ï¸ ä»Šæ—¥å›¾åƒç§¯åˆ†æ¶ˆè€—
- ğŸ¬ ä»Šæ—¥è§†é¢‘ç§¯åˆ†æ¶ˆè€—
- ğŸ“Š æ³¨å†Œè¶‹åŠ¿å›¾è¡¨ï¼ˆ30å¤©ï¼‰
- ğŸ“Š ç§¯åˆ†æ¶ˆè€—è¶‹åŠ¿å›¾è¡¨
- ğŸ“¥ æ•°æ®å¯¼å‡ºï¼ˆCSVï¼‰

### 2. Usersï¼ˆç”¨æˆ·ç®¡ç†ï¼‰
**è·¯å¾„**: `/admin/users`

**åŠŸèƒ½**ï¼š
- ğŸ“‹ ç”¨æˆ·åˆ—è¡¨ï¼ˆé‚®ç®±ã€å§“åã€æ³¨å†Œæ—¥æœŸï¼‰
- ğŸ” é‚®ç®±æœç´¢
- ğŸ’³ è®¢é˜…è®¡åˆ’æ˜¾ç¤º
- ğŸ’° ç§¯åˆ†ä½™é¢
- ğŸ“Š æ€»è·å¾—/æ€»æ¶ˆè€—ç§¯åˆ†
- ğŸ“¥ ç”¨æˆ·æ•°æ®å¯¼å‡º

### 3. Subscriptionsï¼ˆè®¢é˜…ç®¡ç†ï¼‰
**è·¯å¾„**: `/admin/subscriptions`

**åŠŸèƒ½**ï¼š
- ğŸ“Š å„è®¡åˆ’ç”¨æˆ·åˆ†å¸ƒï¼ˆFree/Pro/Pro+ï¼‰
- ğŸ“ˆ è®¢é˜…çŠ¶æ€ç»Ÿè®¡ï¼ˆActive/Canceled/Expiredï¼‰
- ğŸ“‹ æœ€è¿‘è®¢é˜…åˆ—è¡¨
- ğŸ’µ è®¢é˜…é‡‘é¢
- ğŸ“… å¼€å§‹/ç»“æŸæ—¥æœŸ
- ğŸ“¥ è®¢é˜…æ•°æ®å¯¼å‡º

### 4. Paymentsï¼ˆæ”¯ä»˜ç®¡ç†ï¼‰
**è·¯å¾„**: `/admin/payments`

**åŠŸèƒ½**ï¼š
- ğŸ’° æ€»æ”¶å…¥ç»Ÿè®¡
- ğŸ“Š æ—¶é—´èŒƒå›´å†…æ”¶å…¥
- ğŸ”¢ äº¤æ˜“æ•°é‡
- ğŸ“ˆ å¹³å‡äº¤æ˜“é‡‘é¢
- ğŸ“Š æ”¶å…¥è¶‹åŠ¿å›¾è¡¨
- ğŸ“‹ æœ€è¿‘æ”¯ä»˜è®°å½•
- ğŸ’³ æ”¯ä»˜çŠ¶æ€
- ğŸ¦ æ”¯ä»˜æä¾›å•†ï¼ˆStripe/Creemï¼‰
- ğŸ“¥ æ”¯ä»˜æ•°æ®å¯¼å‡º

### 5. Creditsï¼ˆç§¯åˆ†ç®¡ç†ï¼‰
**è·¯å¾„**: `/admin/credits`

**åŠŸèƒ½**ï¼š
- ğŸ“Š æ€»ç§¯åˆ†æ¶ˆè€—ç»Ÿè®¡
- ğŸ–¼ï¸ å›¾åƒç§¯åˆ†æ¶ˆè€—
- ğŸ¬ è§†é¢‘ç§¯åˆ†æ¶ˆè€—
- ğŸ‘‘ Top 10 ç”¨æˆ·ï¼ˆæŒ‰ç§¯åˆ†æ¶ˆè€—ï¼‰
- ğŸ“Š ç§¯åˆ†æ¶ˆè€—è¶‹åŠ¿ï¼ˆå †å æŸ±çŠ¶å›¾ï¼‰
- ğŸ“‹ ç”¨æˆ·ç§¯åˆ†æ˜ç»†è¡¨
- ğŸ“¥ ç§¯åˆ†æ•°æ®å¯¼å‡º

### 6. Settingsï¼ˆè®¾ç½®ï¼‰
**è·¯å¾„**: `/admin/settings`

**åŠŸèƒ½**ï¼š
- âš™ï¸ ç®¡ç†å‘˜è®¾ç½®ï¼ˆå¾…å®ç°ï¼‰

---

## ğŸ” è®¿é—®ç®¡ç†å‘˜ Dashboard

### ç™»å½•

1. è®¿é—®: `https://your-domain.com/admin/login`
2. è¾“å…¥ç®¡ç†å‘˜é‚®ç®±å’Œå¯†ç 
3. å‹¾é€‰ "Remember me"ï¼ˆå¯é€‰ï¼Œä¿æŒç™»å½•30å¤©ï¼‰
4. ç‚¹å‡» "Login"

### ç™»å‡º

ç‚¹å‡»å³ä¸Šè§’çš„ "Logout" æŒ‰é’®

---

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### è®¤è¯æœºåˆ¶
- âœ… JWT Token è®¤è¯
- âœ… HTTP-only Cookie å­˜å‚¨
- âœ… å¯†ç  bcrypt åŠ å¯†å­˜å‚¨
- âœ… Token 7å¤©è¿‡æœŸï¼ˆRemember me 30å¤©ï¼‰
- âœ… ä¸­é—´ä»¶è·¯ç”±ä¿æŠ¤

### æƒé™éªŒè¯
- âœ… æ‰€æœ‰ç®¡ç†å‘˜ API éœ€è¦éªŒè¯ admin token
- âœ… è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µé¢
- âœ… é˜²æ­¢éç®¡ç†å‘˜è®¿é—®

### API ä¿æŠ¤
æ‰€æœ‰ç®¡ç†å‘˜ API (`/api/admin/*`) éƒ½ä½¿ç”¨ `requireAdmin()` è¿›è¡Œä¿æŠ¤ã€‚

---

## ğŸ“Š æ•°æ®å¯¼å‡º

æ¯ä¸ªé¡µé¢éƒ½æ”¯æŒ CSV æ•°æ®å¯¼å‡ºï¼š

**Dashboard**:
- Dashboard ç»Ÿè®¡æ•°æ®
- æ³¨å†Œè¶‹åŠ¿æ•°æ®
- ç§¯åˆ†è¶‹åŠ¿æ•°æ®

**Users**:
- ç”¨æˆ·åˆ—è¡¨å®Œæ•´æ•°æ®

**Subscriptions**:
- è®¢é˜…è®°å½•

**Payments**:
- æ”¯ä»˜è®°å½•

**Credits**:
- ç§¯åˆ†æ±‡æ€»æ•°æ®
- Top 10 ç”¨æˆ·æ•°æ®
- ç§¯åˆ†è¶‹åŠ¿æ•°æ®

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### å‰ç«¯
- **Framework**: Next.js 15 (App Router)
- **UI Components**: shadcn/ui
- **Charts**: Recharts
- **Styling**: TailwindCSS
- **Icons**: Lucide React

### åç«¯
- **Database**: Neon (PostgreSQL)
- **ORM**: Drizzle ORM
- **Authentication**: JWT + bcrypt
- **API**: Next.js API Routes

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ layout.tsx                 # ç®¡ç†å‘˜å¸ƒå±€ï¼ˆä¾§è¾¹æ +é¡¶æ ï¼‰
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # Dashboard ä¸»é¡µ
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ subscriptions/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # è®¢é˜…ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # æ”¯ä»˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ credits/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # ç§¯åˆ†ç®¡ç†
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚       â””â”€â”€ page.tsx              # è®¾ç½®
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ admin/
â”‚           â”œâ”€â”€ auth/
â”‚           â”‚   â”œâ”€â”€ login/route.ts    # ç™»å½• API
â”‚           â”‚   â””â”€â”€ logout/route.ts   # ç™»å‡º API
â”‚           â”œâ”€â”€ dashboard/
â”‚           â”‚   â””â”€â”€ stats/route.ts    # Dashboard ç»Ÿè®¡
â”‚           â”œâ”€â”€ users/
â”‚           â”‚   â””â”€â”€ route.ts          # ç”¨æˆ·åˆ—è¡¨
â”‚           â”œâ”€â”€ subscriptions/
â”‚           â”‚   â””â”€â”€ stats/route.ts    # è®¢é˜…ç»Ÿè®¡
â”‚           â”œâ”€â”€ payments/
â”‚           â”‚   â””â”€â”€ stats/route.ts    # æ”¯ä»˜ç»Ÿè®¡
â”‚           â””â”€â”€ credits/
â”‚               â””â”€â”€ summary/route.ts  # ç§¯åˆ†æ±‡æ€»
â”œâ”€â”€ components/
â”‚   â””â”€â”€ admin/
â”‚       â”œâ”€â”€ admin-sidebar.tsx         # ä¾§è¾¹æ å¯¼èˆª
â”‚       â””â”€â”€ admin-topbar.tsx          # é¡¶éƒ¨æ 
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ auth.ts                   # ç®¡ç†å‘˜è®¤è¯å·¥å…·
â”œâ”€â”€ middleware.ts                      # è·¯ç”±ä¸­é—´ä»¶ï¼ˆåŒ…å« admin ä¿æŠ¤ï¼‰
â””â”€â”€ scripts/
    â””â”€â”€ create-admin.ts               # åˆ›å»ºç®¡ç†å‘˜è„šæœ¬
```

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨

### admins è¡¨
```sql
CREATE TABLE admins (
  id TEXT PRIMARY KEY,
  email TEXT NOT NULL UNIQUE,
  password_hash TEXT NOT NULL,
  name TEXT,
  role TEXT NOT NULL DEFAULT 'admin',
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  last_login_at TIMESTAMP
);
```

å·²åœ¨ `src/server/db/schema.ts` ä¸­å®šä¹‰ã€‚

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: ç™»å½•åè·³è½¬å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `ADMIN_JWT_SECRET` ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
- æ¸…é™¤æµè§ˆå™¨ cookies å¹¶é‡æ–°ç™»å½•

### é—®é¢˜2: API è¿”å› 401 Unauthorized

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿å·²ç™»å½•
- æ£€æŸ¥ admin_token cookie æ˜¯å¦å­˜åœ¨
- é‡æ–°ç™»å½•

### é—®é¢˜3: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æ•°æ®åº“è¿ç§»å·²è¿è¡Œ
- æ£€æŸ¥ Neon æ•°æ®åº“è¿æ¥
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

---

## ğŸ”„ åç»­ä¼˜åŒ–

- [ ] å®æ—¶æ•°æ®è‡ªåŠ¨åˆ·æ–°
- [ ] é«˜çº§ç”¨æˆ·æœç´¢å’Œç­›é€‰
- [ ] ç”¨æˆ·è¯¦æƒ…é¡µé¢
- [ ] ç®¡ç†å‘˜è§’è‰²æƒé™ç®¡ç†
- [ ] å®¡è®¡æ—¥å¿—
- [ ] è‡ªå®šä¹‰æŠ¥è¡¨
- [ ] é‚®ä»¶é€šçŸ¥
- [ ] æ•°æ®å¤‡ä»½åŠŸèƒ½

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯å›¢é˜Ÿæˆ–æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ã€‚

**åˆ›å»ºæ—¶é—´**: 2025-11-12  
**ç‰ˆæœ¬**: v1.0

